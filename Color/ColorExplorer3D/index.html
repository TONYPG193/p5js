<!DOCTYPE html>
<html>

<head>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.1.9/p5.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css\style.css">
  <meta charset="utf-8">
</head>

<body>

  <!-- <script src="../ColorPanel2D/color-picker-panel.js"></script>
  <script src="../ColorPanel2D/color-panel-2d.js"></script>
  <script src="../ColorCube3D/color-cube-3d.js"></script>
  <script src="../ColorCube3D/color-axes-3d.js"></script> -->

  <iframe id="color-cube-iframe" src="color-cube.html" width="600px" height="400px"></iframe>
  <iframe id="color-picker-2d-iframe" src="color-picker-2d.html" width="600px" height="150px"></iframe>
  <div id="frame-rates">
    <span id="color-cube-frame-rate">fps</span>
  </div>
  <div id="colors">
    Selected color: <span id="selected-color">0, 0, 0</span><br />
    Hover color: <span id="hover-color">0, 0, 0</span>
  </div>

  <!--
    TODO:
    - add in hover support to cube
    - [done] visualize text on previous, current, and hover panels
    - [done] add event system to cube 3d
    - fix the show columns mode in cube 3d
    - combine the cube 3d axis into the cube 3d class
    - add in intro anim where cube starts full and then crumbles away? 
    - setup better default camera view?
    - [] pick random default color
    - [done] add in ticks on color panel? and axes?
    - [] add in outer ticks in color panel 2d? Or, actually, maybe compactly fit in red and green on axis?
    - [] there is a bug in the color sliders when setting a color, sometimes other sliders are affected
    - [] is there a bug in printing out the hex color?
    - [] add hover and selected color to html?
  -->
  <script>
    setInterval(outputFrameRate, 500);

    function outputFrameRate() {
      let colorCubeWindow = document.getElementById('color-cube-iframe').contentWindow;
      if (typeof colorCubeWindow.frameRate === 'function') {
        let colorCubeFrameRate = colorCubeWindow.frameRate();
        document.getElementById("color-cube-frame-rate").innerHTML = colorCubeFrameRate.toFixed(1) + " fps";
      }

      //let colorPanelFrameRate = document.getElementById('color-picker-2d-iframe').contentWindow.frameRate();
      //document.getElementById("color-panel-frame-rate").innerHTML = colorPanelFrameRate.toFixed(1) + " fps";

    }

    function broadcastNewHoverColor(sender, newHoverColor) {
      console.log("broadcastNewHoverColor", sender, newHoverColor);

      document.getElementById("hover-color").innerHTML = newHoverColor;

      // To get global vars in iframes, see: https://stackoverflow.com/a/7647192
      let rgbColorPickerPanel2d = document.getElementById('color-picker-2d-iframe').contentWindow[
        'rgbColorPickerPanel'];
      let colorCube = document.getElementById('color-cube-iframe').contentWindow['colorCube3D'];
      if (sender === rgbColorPickerPanel2d) {
        colorCube.setHoverColor(newHoverColor);
      } else if (sender === colorCube) {
        rgbColorPickerPanel2d.setHoverColor(newHoverColor);
      }
    }

    function broadcastNewSelectedColor(sender, newSelectedColor) {
      console.log("broadcastNewSelectedColor", sender, newSelectedColor);


      document.getElementById("selected-color").innerHTML = newSelectedColor;

      // To get global vars in iframes, see: https://stackoverflow.com/a/7647192
      let rgbColorPickerPanel2d = document.getElementById('color-picker-2d-iframe').contentWindow[
        'rgbColorPickerPanel'];
      let colorCube = document.getElementById('color-cube-iframe').contentWindow['colorCube3D'];
      if (sender === rgbColorPickerPanel2d) {
        colorCube.setSelectedColor(newSelectedColor);
      } else if (sender === colorCube) {
        rgbColorPickerPanel2d.setSelectedColor(newSelectedColor);
      }
    }

    function areColorLevelsEqual(col1, col2, includeAlpha = true) {
      let areEqual = col1.levels[0] === col2.levels[0] &&
        col1.levels[1] === col2.levels[1] &&
        col1.levels[2] === col2.levels[2];

      if (includeAlpha) {
        areEqual &= col1.levels[3] === col2.levels[3];
      }
      return areEqual;
    }
  </script>
</body>

</html>